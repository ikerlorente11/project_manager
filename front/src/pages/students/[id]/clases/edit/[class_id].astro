---
import Layout from "../../../../../layouts/Layout.astro";
import Header from "../../../../../components/Header.astro";
import Back from "../../../../../components/Back.astro";
import ClassForm from "../../../../../components/ClassForm.astro";

// Habilitar Server-Side Rendering (SSR)
export const prerender = false;

const { id, class_id } = Astro.params;

let student = null;
let current_class = null;

const API_BASE_URL = import.meta.env.API_BASE_URL;

try {
    const response = await fetch(`${API_BASE_URL}/students?id=${id}`);
    if (response.ok) {
        student = await response.json();

        try {
            const response = await fetch(
                `${API_BASE_URL}/classes?id=${class_id}`,
            );
            if (response.ok) {
                current_class = await response.json();
            } else {
                console.error("Error: Class not found");
            }
        } catch (error) {
            console.error("Error fetching clases:", error);
        }
    } else {
        console.error("Error: Student not found");
    }
} catch (error) {
    console.error("Error fetching student:", error);
}
---

<Layout>
    <Back url=`${import.meta.env.BASE_URL}students/${id}` />
    <Header name={student.name} price={student.price} />
    <ClassForm
        user_id={id}
        price={student.price}
        current_class={current_class}
    />
</Layout>

<style>
    .back-button {
        position: absolute;
        color: var(--color-primary);
    }

    .back-button svg {
        margin-top: 0.5rem;
    }
</style>
